name: Clone Issue to Matching Repo on Label

on:
  issues:
    types: [labeled]
  workflow_dispatch:  # Optional: For manual testing
    inputs:
      target_repo:
        description: 'Target repository (e.g., owner/WDP-BaseDet)'
        required: true
        default: 'owner/WDP-BaseDet'  # Replace with a test default

jobs:
  clone-issue:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      issues: write

    steps:
      - name: Set target repo based on label
        id: set-target
        env:
          LABEL_NAME: ${{ github.event_name == 'issues' && github.event.label.name || '' }}
        run: |
          if [[ "$LABEL_NAME" == WDP-* ]]; then
            OWNER="${{ github.repository_owner }}"
            echo "target_repo=$OWNER/$LABEL_NAME" >> $GITHUB_OUTPUT
          else
            echo "Label does not start with 'WDP-'. Skipping."
            exit 0  # Exit successfully to skip further steps
          fi

      - name: Create duplicate issue in target repo
        if: ${{ steps.set-target.outputs.target_repo || github.event_name == 'workflow_dispatch' }}
        env:
          GH_TOKEN: ${{ github.token }}  # Switch to ${{ secrets.PAT_FOR_CLONE }} if auth fails
          TARGET_REPO: ${{ steps.set-target.outputs.target_repo || inputs.target_repo }}
        run: |
          gh issue create \
            --repo "$TARGET_REPO" \
            --title "${{ github.event.issue.title }}" \
            --body "${{ github.event.issue.body }}\n\nOriginal issue: ${{ github.event.issue.html_url }}"
